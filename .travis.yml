language: java
jdk:
  - oraclejdk8

before_deploy:
    on:
      tags: true


before_script:
    - docker login -e="$DOCKERHUB_EMAIL" -u="$DOCKERHUB_USER" -p="$DOCKERHUB_PASSWORD"
   # - docker pull grupoasv/mule:latest;
    - chmod +x ./script/bucle_check_url.sh;
    - docker-compose up & ./script/bucle_check_url.sh;

script:
    - echo "El job de Travis es: ${TRAVIS_JOB_NUMBER}";
#    - chmod +x ./script/execute-test.sh;
#    - ./script/execute-test.sh localhost
    - mvn test -Denv.IPTRAVIS=http://localhost -Denv.TRAVIS_JOB_NUMBER=${TRAVIS_JOB_NUMBER};

#after_success:
#  - echo "${TRAVIS_TAG}"
#  - if [[ "${TRAVIS_TAG}" =~ (.*)-TESTME ]]; then mvn test; fi

addons:
  sauce_connect:
    username: "travis-arq-testing1"
    access_key: "0c5a2380-863d-45c7-b6d0-2c55d6d93ba1"
    #access_key: "dfcd0c77-25c6-42ba-92f3-d85e08bb036c"
    #username: "Your Sauce Labs access key"
    #access_key: "Your Sauce Labs access key"

services:
  - docker

env:
  DOCKER_COMPOSE_VERSION: 1.8.1
  
before_install:
  - sudo rm /usr/local/bin/docker-compose
  - curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname -s`-`uname -m` > docker-compose
  - chmod +x docker-compose
  - sudo mv docker-compose /usr/local/bin
  #- cd /usr/local/bin
  #- ls -la
